/*!
 * pure-form - v1.0.0
 * JSON Schema driven Form written in pure JavaScript as a Web Component
 * https://github.com/john-doherty/pure-form
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(t,e,r){"use strict";function i(t,e){var r={};return r[t]=e,this.isValid(r)}function a(){var t=this,r=this.src;T.get(r,"application/json",function(e){t.dispatchEvent(new CustomEvent("schema-error",{detail:e,bubbles:!1}))},function(r){if(t.schema=JSON.parse(r.body),t.dispatchEvent(new CustomEvent("schema-loaded",{detail:r,bubbles:!1})),t.persist&&e.sessionStorage&&e.sessionStorage[t.src]){var i=e.sessionStorage[t.src]||"";""!==i&&f.call(t,JSON.parse(i))}})}function n(){if(this.schema){var t=this,e=this.schema.properties,r=y(this.schema),a=null;this.form=this.querySelector(".pure-form-form"),this.form||(t.useFormTag?(this.form=b(null,"form",{action:"",method:"post",class:"pure-form-form",novalidate:"novalidate"}),""===this.getAttribute("create-url")&&""===this.getAttribute("update-url")||(this.form.onsubmit=function(t){t.preventDefault()})):this.form=b(null,"div",{class:"pure-form-form"}),this.form.addEventListener("focusout",function(e){var r=e.target;"submit"!==r.type&&t.validateOnBlur&&i.call(t,r.id,r.value)},!0),this.form.addEventListener("keyup",function(e){var r=e.target;if(t.tabOnEnter&&13===e.keyCode&&("INPUT"===r.tagName||"TEXTAREA"===r.tagName||"SELECT"===r.tagName)){e.preventDefault();var i=Array.prototype.slice.call(t.form.querySelectorAll(".pure-form-item"));i.forEach(function(t,e){r===t&&i[e+1]&&i[e+1].focus()})}l(r)})),this.form.innerHTML="",r=r.filter(function(t){return"links"!==t&&-1===t.indexOf("$")&&e.hasOwnProperty(t)});for(var n=0;n<r.length;n++){var s=r[n],u=e[s];a=b(null,"label",{for:s,class:"pure-form-label"}),u.format&&a.setAttribute("data-format",u.format),u.type&&a.setAttribute("data-type",u.type),u.required&&a.setAttribute("data-required",!0),b(a,"span",{class:"pure-form-label-text"},u.title||s);var c=d.call(this,s,u);if(!c)throw new Error("Failed to convert schema item to html element (key:"+s+")");var m="hidden"===c.type;this.readonly?(c.setAttribute("readonly","true"),"SELECT"===c.tagName&&c.setAttribute("disabled","true")):m||(0===n&&c.setAttribute("autofocus","true"),c.className="pure-form-item"),m?this.form.appendChild(c):(a.appendChild(c),u.description&&u.description.length>this.placeholderMaxLength&&b(a,"span",{class:"pure-form-item-description"},u.description||""),l(c),this.form.appendChild(a)),this.appendChild(this.form)}o.call(this),t.dispatchEvent(new CustomEvent("render-complete",{bubbles:!1})),t.addEventListener("button-clicked",function(e){var r=e.detail,i=x((t.schema||{}).links,"title",r,!0)||x((t.schema||{}).links,"rel",r,!0);h.call(t,i)})}}function s(){if(""!==this.title){var t=b(null,"div",{class:"pure-form-title"},this.title);this.insertBefore(t,this.form)}else k(this,".pure-form-title")}function u(){if(""!==this.description){var t=b(null,"div",{class:"pure-form-description"},this.description);this.insertBefore(t,this.form)}else k(this,".pure-form-description")}function o(){var t=this;if(this.form&&""!==this.buttons){var e=this.buttons.split(","),r=this.form.querySelector(".pure-form-buttons")||b(this.form,"div",{class:"pure-form-buttons"});r.innerHTML="",e.forEach(function(t){b(r,"input",{type:"submit",value:t.trim(),class:"pure-form-button"})}),this.schema&&Array.isArray(this.schema.links)&&this.schema.links.forEach(function(t){b(r,"input",{type:"submit",value:(t.title||t.rel).trim(),class:"pure-form-button"})}),r.onclick=function(e){var r=e.target;"INPUT"===r.tagName&&"submit"===r.type&&t.dispatchEvent(new CustomEvent("button-clicked",{detail:r.value,bubbles:!0,cancelable:!0}))}}else k(this,".pure-form-buttons")}function l(t){var e=parseInt(t.getAttribute("maxlength")||t.getAttribute("data-maxlength")||"0",10),r=p(t,"tagName","LABEL");if(r&&e>0){var i=t.value.length;r.setAttribute("data-max-length",e),e>0?t.parentElement.setAttribute("data-characters-remaining",e-i):t.parentElement.removeAttribute("data-characters-remaining"),t.removeAttribute("data-valid"),r.removeAttribute("data-error")}}function c(){var t=this,e=(this.schema||{}).properties||{},r={};return Object.keys(e).forEach(function(i){if(!("links"===i&&i.indexOf("$")>-1)){var a=e[i];if(e[i].readonly)r[i]=this.value&&this.value[i]||a.required&&a.default||void 0;else{var n=t.querySelector('[name="'+i+'"]');if(n)switch(a.type){case"array":"textarea"===a.items.format?r[i]=""!==n.value?n.value.split("\n"):[]:"uri"===a.items.format?r[i]=n.data:(Array.isArray(n.value),r[i]=n.value);break;case"boolean":r[i]=n.checked;break;case"integer":r[i]=n.value?parseInt(n.value,10):"";break;case"number":r[i]=n.value?parseFloat(n.value):"";break;default:r[i]=(n.value||"").trim(),a.maxLength&&(r[i]=r[i].substr(0,Math.max(a.maxLength,0)))}a.required||""!==r[i]||delete r[i]}}}),r}function m(){var t=this.schema.properties,e={};for(var r in t)if("links"!==r&&-1===r.indexOf("$")&&!t[r].readonly&&t.hasOwnProperty(r)){var i=t[r],a=this.querySelector('[name="'+r+'"]');if(a)switch(i.type){case"array":"uri"===i.items.format||"object"===i.items.type?e[r]=a.data:e[r]=a.value;break;case"boolean":e[r]=a.checked;break;default:e[r]=(a.value||"").trim()}}return e}function h(t){if(t){var e=this,i=c.call(this),a=t.href||r.location.href,n=(t.method||"POST").toLowerCase(),s=t.enctype||"application/json";e.clearErrors(),e.isValid(i)&&T[n](a,s,i,function(t){e.dispatchEvent(new CustomEvent("submit-failed",{detail:a,bubbles:!1}))},function(t){e.dispatchEvent(new CustomEvent("submit-successful",{detail:t,bubbles:!1}))})}}function f(t){var e=t,r=this.value,i=this;Object.keys(e).forEach(function(t){var r=i.querySelector('[name="'+t+'"]'),a=void 0!==e[t]?e[t]:"";r&&(E(r,a),i.schema.properties[t].maxLength&&l(r))});var a={oldValue:r,newValue:e};i.dispatchEvent(new CustomEvent("value-set",{detail:a,bubbles:!1}))}function d(t,e){var r=null,i=e.items&&e.items.type||e.type,a=(e.items&&e.items.format||e.format||"").toLowerCase();switch(i){case"number":case"integer":if(Number.isInteger(e.minimum)&&Number.isInteger(e.maximum)){b(r=b(null,"select",{name:t,id:t}),"option",{value:""});for(var n=e.minimum;n<=e.maximum;n++)b(r,"option",{value:n},n)}else r=b(null,"input",{name:t,id:t,type:"number",value:""});break;default:if(Array.isArray(e.enum))b(r=b(null,"select",{name:t,id:t}),"option",{value:""}),e.enum.forEach(function(t){b(r,"option",{value:t},t)});else switch(a.toLowerCase()){case"url":case"uri":r=b(null,"input",{name:t,id:t,type:"url",value:""});break;case"textarea":r=b(null,"textarea",{name:t,id:t,value:"",rows:3});break;case"date":r=b(null,"input",{name:t,id:t,type:"date",value:""});break;case"password":r=b(null,"input",{name:t,id:t,type:"password",value:""});break;case"email":r=b(null,"input",{name:t,id:t,type:"email",pattern:L.email,value:""});break;default:r=b(null,"input",{name:t,id:t,type:"text",value:""})}}return r&&(r.setAttribute("autocomplete","off"),e.readonly&&r.setAttribute("readonly","true"),e.readonly&&"SELECT"===r.tagName&&r.setAttribute("disabled","true"),e.required&&r.setAttribute("required","required"),e.pattern&&r.setAttribute("pattern",e.pattern),e.min&&r.setAttribute("min",e.min),e.max&&r.setAttribute("max",e.max),e.minLength&&r.setAttribute("minlength",e.minLength),e.maxLength&&r.setAttribute(this.enforceMaxLength?"maxlength":"data-maxlength",e.maxLength),e.minItems&&r.setAttribute("min-items",e.minItems),e.maxItems&&r.setAttribute("max-items",e.maxItems),e.description&&e.description.length<this.placeholderMaxLength&&r.setAttribute("placeholder",e.description||"")),r}function p(t,e,r){r="className"===(e="class"===e?"className":e)?"(^|\\s)"+r+"(\\s|$)":r;for(var i=t.parentNode;null!==i&&i.tagName&&"html"!==i.tagName.toLowerCase();){if(i[e]===r||i.getAttribute(e)===r||"className"===e&&i[e].matches(r))return i;i=i.parentNode}return null}function b(t,e,i,a,n){var s=r.createElement(e),u=e.indexOf("-")>0;if(i)for(var o in i)"class"===o?s.className=i[o]:"id"===o?s.id=i[o]:"name"===o?s.setAttribute(o,i[o]):u||o in s?s[o]=i[o]:s.setAttribute(o,i[o]);return void 0!==a&&s.appendChild(r.createTextNode(a)),void 0!==n&&(s.innerHTML="",v(n,s)),t&&t.appendChild(s),s}function v(t,e){e=e||r.createDocumentFragment();var i=null,a=r.createElement("div");a.innerHTML=t;for(var n=a.getElementsByTagName("script"),s=n.length-1;s>=0;s--)n[s].parentElement.removeChild(n[s]);for(;i=a.firstChild;)e.appendChild(i);return e}function g(t,e,r){var i=A(t,e,!0),a=(r+"").length;if(i){if(r&&"string"===i.type&&"email"===i.format&&!C(r.toString(),L.email))return"Invalid email address";if(r&&i.minLength&&a<i.minLength)return"The value must have a minimum of "+i.minLength+" character(s)";if(r&&i.maxLength&&a>i.maxLength)return"Maximum "+i.maxLength+" character"+(a>1?"s":"");if(i.required&&(!r||Array.isArray(r)&&r.length<=0))return"This field must have a value";if(i.minItems&&Array.isArray(r)&&r.length<i.minItems)return"Please select at least "+i.minItems+" item(s)";if(i.maxItems&&Array.isArray(r)&&r.length>i.maxItems)return"Please select a maximum of "+i.maxItems+" item(s)";if(r&&i.pattern&&!C(r.toString(),i.pattern))return"The value is not in the expected format";if(r&&i.minimum&&parseInt(r,10)<i.minimum)return"The value must not be lower than "+i.minimum;if(r&&i.maximum&&parseInt(r,10)>i.maximum)return"The value must not be higher than "+i.maximum}return null}function A(t,e,r){if(void 0===t)return!1;(r=void 0!==t.$schema||r)&&(t.properties&&e.indexOf(".properties")<=-1?e="properties."+e:t.items&&e.indexOf(".items")<=-1&&(e="items."+e));var i=e.indexOf(".");return i>-1?(t=t[e.substring(0,i)],e=e.substr(i+1),A(t,e,r)):t[e]}function y(t){t=t.properties||t;var e=Object.keys(t);return e.sort(function(e,r){return(t[e].id?parseInt(t[e].id.replace(/[^0-9]+/gi,"")||"0",10):0)-(t[r].id?parseInt(t[r].id.replace(/[^0-9]+/gi,"")||"0",10):0)}),e}function E(t,e){var r=t?t.tagName.toLowerCase():"",i=t.type||"";switch(r){case"input":"checkbox"===i?e?t.setAttribute("checked",!0===e):t.removeAttribute("checked"):t.value=e;break;case"textarea":t.value=e.join?e.join("\n"):e;break;default:t.value=e}}function x(t,e,r,i){for(var a=[],n=0,s=(t=t||[]).length;n<s;n++)if(t[n][e]===r){if(i)return t[n];a.push(t[n])}return i?null:a}function k(t,e){var i=(t||r).querySelector(e);i&&i.parentElement.removeChild(i)}function C(t,e){return(e.constructor!==RegExp?new RegExp(e,"g"):e).test(t)}var L={email:"^[a-zA-Z0-9.-_]{1,}@[a-zA-Z.-]{2,}[.]{1}[a-zA-Z]{2,}$"},w=Object.create(t,{src:{get:function(){return this.getAttribute("src")||""},set:function(t){this.setAttribute("src",t)}},schema:{get:function(){return this._schema||null},set:function(t){this._schema=t,this.title=this._schema.title,this.description=this._schema.description;var e=x(this._schema.links,"rel","self",!0);e&&(this.updateUrl=e.href);var r=x(this._schema.links,"rel","create",!0);r&&(this.createUrl=r.href),n.call(this)}},value:{get:function(){return c.call(this)},set:function(t){f.call(this,t)}},createUrl:{get:function(){return this.getAttribute("create-url")||""},set:function(t){this.setAttribute("create-url",t)}},updateUrl:{get:function(){return this.getAttribute("update-url")||""},set:function(t){this.setAttribute("update-url",t)}},readonly:{get:function(){return"true"===this.getAttribute("readonly")},set:function(t){t?this.setAttribute("readonly",t):this.removeAttribute("readonly")}},title:{get:function(){return this.getAttribute("title")||""},set:function(t){this.setAttribute("title",t||"")}},description:{get:function(){return this.getAttribute("description")||""},set:function(t){this.setAttribute("description",t||"")}},buttons:{get:function(){return this.getAttribute("buttons")||""},set:function(t){t=t.split(",").filter(Boolean).join(","),this.setAttribute("buttons",t)}},persist:{get:function(){return"true"===this.getAttribute("persist")},set:function(t){this.setAttribute("persist",!0===t)}},disableValidation:{get:function(){return"true"===this.getAttribute("disable-validation")},set:function(t){this.setAttribute("disable-validation",!0===t)}},placeholderMaxLength:{get:function(){return parseInt(this.getAttribute("placeholder-max-length")||"75",10)},set:function(t){this.setAttribute("placeholder-max-length",t)}},autofocusError:{get:function(){return"true"===this.getAttribute("autofocus-error")},set:function(t){this.setAttribute("autofocus-error",!0===t)}},validateOnBlur:{get:function(){return"true"===this.getAttribute("validate-on-blur")},set:function(t){this.setAttribute("validate-on-blur",!0===t),t&&(this.autofocusError=!1)}},tabOnEnter:{get:function(){return"true"===this.getAttribute("tab-on-enter")},set:function(t){this.setAttribute("tab-on-enter",!0===t)}},useFormTag:{get:function(){return"true"===this.getAttribute("use-form-tag")},set:function(t){this.setAttribute("use-form-tag",!0===t)}},enforceMaxLength:{get:function(){return"true"===this.getAttribute("enforce-max-length")},set:function(t){this.setAttribute("enforce-max-length",!0===t)}}});w.createdCallback=function(){var t=this;Array.prototype.slice.call(t.attributes).forEach(function(e){t.attributeChangedCallback(e.name,null,e.value)})},w.attributeChangedCallback=function(t,e,r){if(e!==r)switch(t){case"src":a.call(this);break;case"title":s.call(this);break;case"description":u.call(this);break;case"buttons":o.call(this);break;case"use-form-tag":case"enforce-maxlength":var i=this.value;n.call(this),this.value=i}},w.clearError=function(t){var e=this.querySelector('[name="'+t+'"]');e&&(e.setAttribute("data-valid","true"),e.parentNode.removeAttribute("data-error"))},w.clearErrors=function(){this.form.removeAttribute("data-error"),Array.prototype.slice.call(this.querySelectorAll("[data-error]")).forEach(function(t){t.removeAttribute("data-error")}),Array.prototype.slice.call(this.querySelectorAll("[data-valid]")).forEach(function(t){t.removeAttribute("data-valid")})},w.setError=function(t,e){var r=this.querySelector('[name="'+t+'"]');r&&(r.setAttribute("data-valid","false"),r.parentNode.setAttribute("data-error",e))},w.isValid=function(t,r){if(this.disableValidation)return!0;t=t||c.call(this);var i=this,a=this.schema,n=!0;if(Object.keys(t).forEach(function(e){var s=i.querySelector('[name="'+e+'"]'),u=a.properties[e].pattern?s&&s.value||t[e]:t[e],o=g(a,e,u);r?o&&(n=!1):o?(i.setError(e,o),n=!1):i.clearError(e)}),this.persist&&e.sessionStorage&&(e.sessionStorage[this.src]=JSON.stringify(m.call(this))),!r&&this.autofocusError){var s=this.querySelector('form [data-valid="false"]');s&&s.focus()}return n},w.reset=function(){var t={},e=(this.schema||{}).properties||{};Object.keys(e).filter(function(t){return"links"!==t&&t.indexOf("$")<=-1}).forEach(function(r){t[r]=e[r].default||""}),this.value=t},"initCustomEvent"in r.createEvent("CustomEvent")&&(e.CustomEvent=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=r.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i},e.CustomEvent.prototype=e.Event.prototype);var T=function(){function t(){try{return new XMLHttpRequest}catch(t){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){return console&&console.log("pure-form: XMLHttpRequest not supported"),null}}}function e(t){return Object.keys(t||{}).map(function(e){return encodeURI(e+"="+t[e])}).join("&")}function r(r,i,a,n,s,u){var o=t();if(o="withCredentials"in o?o:new XDomainRequest){if(r=r||"GET",a=a||"application/json",o.open(r,i),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type",a),o.onreadystatechange=function(){4===o.readyState&&(200===o.status||0===o.status&&""!==o.responseText?u({url:i,status:200,body:o.responseText||""}):s({url:i,status:o.status,body:o.responseText||""}))},n)switch(a){case"application/x-www-form-urlencoded":n=e(n);break;default:n=JSON.stringify(n)}o.send(n||null)}}return{get:function(t,e,i,a){r("GET",t,e,null,i,a)},post:function(t,e,i,a,n){r("POST",t,e,i,a,n)},put:function(t,e,i,a,n){r("PUT",t,e,i,a,n)},patch:function(t,e,i,a){r("PATCH",t,e,i,a)},delete:function(t,e,i,a){r("DELETE",t,e,i,a)}}}();if(!r.registerElement)throw new Error("document.registerElement does not exist. Are you missing the polyfill?");r.registerElement("pure-form",{prototype:w})}(HTMLElement.prototype,this,document);