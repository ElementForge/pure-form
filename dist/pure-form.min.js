/*!
 * pure-form - v1.0.7
 * Pure JS drop in replacement for the HTML FORM using JSON Schemas
 * https://github.com/john-doherty/pure-form
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(t,e,i){"use strict";function r(t,e){var i={};return i[t]=e,this.isValid(i)}function a(){var t=this,i=this.src;N.get(i,"application/json",null,function(e){t.dispatchEvent(new CustomEvent("schema-error",{detail:e,bubbles:!0,cancelable:!0}))},function(i){if(t.schema=i.body,t.dispatchEvent(new CustomEvent("schema-loaded",{detail:i,bubbles:!0,cancelable:!0})),t.persist&&e.sessionStorage&&e.sessionStorage[t.src]){var r=e.sessionStorage[t.src]||"";""!==r&&f.call(t,JSON.parse(r))}})}function n(){if(this.schema&&"object"==typeof this.schema){var t=this,e=this.schema.properties,i=A(this.schema),a=null;this.form&&this.form.parentElement&&this.form.parentElement.removeChild(this.form),this.useFormTag?(this.form=p(null,"form",{enctype:this.enctype,action:this.action,method:this.method,novalidate:"novalidate",class:"pure-form-form"}),this.form.onsubmit=function(e){t.dispatchEvent(new CustomEvent("submit",{bubbles:!0,cancelable:!0}))&&t.disableValidation&&t.isValid()||e.preventDefault()}):this.form=p(null,"div",{class:"pure-form-form"}),this.form.addEventListener("focusout",function(e){var i=e.target;"submit"!==i.type&&"button"!==i.type&&t.validateOnBlur&&r.call(t,i.id,i.value)},!0),this.form.addEventListener("keyup",function(e){var i=e.target;if(t.tabOnEnter&&13===e.keyCode&&("INPUT"===i.tagName||"TEXTAREA"===i.tagName||"SELECT"===i.tagName)){e.preventDefault();var r=Array.prototype.slice.call(t.form.querySelectorAll(".pure-form-item"));r.forEach(function(t,e){i===t&&r[e+1]&&r[e+1].focus()})}l(i)}),this.form.addEventListener("change",function(t){var e=t.target;if(e&&"INPUT"===e.tagName&&"file"===e.type){var i=Array.prototype.slice.call(t.target.files);e.data=e.data||[],i.forEach(function(t,i){C(t,function(t){e.data[i]=t})})}}),i=i.filter(function(t){return"links"!==t&&-1===t.indexOf("$")&&e.hasOwnProperty(t)});for(var n=0;n<i.length;n++){var s=i[n],o=e[s];a=p(null,"label",{for:s,class:"pure-form-label"}),o.format&&a.setAttribute("data-format",o.format),o.type&&a.setAttribute("data-type",o.type),o.required&&a.setAttribute("data-required",!0),p(a,"span",{class:"pure-form-label-text"},o.title||s);var c=d.call(this,s,o);if(!c)throw new Error("Failed to convert schema item to html element (key:"+s+")");var m="hidden"===c.type;this.readonly?(c.setAttribute("readonly","true"),"SELECT"===c.tagName&&c.setAttribute("disabled","true")):m||(0===n&&c.setAttribute("autofocus","true"),c.className="pure-form-item"),m?this.form.appendChild(c):(a.appendChild(c),o.description&&o.description.length>this.placeholderMaxLength&&p(a,"span",{class:"pure-form-item-description"},o.description||""),l(c),this.form.appendChild(a)),this.appendChild(this.form)}u.call(this),t.dispatchEvent(new CustomEvent("render-complete",{bubbles:!0,cancelable:!0}))}}function s(){if(""!==this.title){var t=this.querySelector(".pure-form-title")||p(null,"div",{class:"pure-form-title"});t.textContent=this.title,t.parentElement||this.insertBefore(t,this.form)}else k(this,".pure-form-title")}function o(){if(""!==this.description){var t=this.querySelector(".pure-form-description")||p(null,"div",{class:"pure-form-description"});t.textContent=this.description,t.parentElement||this.insertBefore(t,this.form)}else k(this,".pure-form-description")}function u(){var t=this,e=this.schema&&Array.isArray(this.schema.links)?this.schema.links:[];if(this.form&&(""!==this.buttons||e.length>0)){var i=this.buttons.split(",").filter(Boolean),r=this.form.querySelector(".pure-form-buttons")||p(this.form,"div",{class:"pure-form-buttons"});r.innerHTML="",i.forEach(function(t){p(r,"input",{type:"submit",value:t.trim(),class:"pure-form-button"})}),(e=e.filter(function(t){return"instances"!==t.rel})).forEach(function(t){var e=(t.title||t.rel).trim();p(r,"input",{type:"button","data-rel":t.rel,value:e,class:"pure-form-button"})}),r.addEventListener(L,function(e){var i=e.target;if("INPUT"===i.tagName){var r={value:i.value,link:null};switch(i.type){case"submit":t.dispatchEvent(new CustomEvent("button-clicked",{detail:{value:i.value},bubbles:!0,cancelable:!0}));break;case"button":var a=i.getAttribute("data-rel");r.link=t.schema&&Array.isArray(t.schema.links)?x(t.schema.links,"rel",a,!0):null,t.dispatchEvent(new CustomEvent("button-clicked",{detail:r,bubbles:!0,cancelable:!0}))}}})}else k(this,".pure-form-buttons")}function l(t){var e=parseInt(t.getAttribute("maxlength")||t.getAttribute("data-maxlength")||"0",10),i=b(t,"tagName","LABEL");if(i&&e>0){var r=t.value.length;i.setAttribute("data-max-length",e),e>0?t.parentElement.setAttribute("data-characters-remaining",e-r):t.parentElement.removeAttribute("data-characters-remaining"),t.removeAttribute("data-valid"),i.removeAttribute("data-error")}}function c(){var t=this,e=(this.schema||{}).properties||{},i={};return Object.keys(e).forEach(function(r){if(!("links"===r&&r.indexOf("$")>-1)){var a=e[r];if(e[r].readonly)i[r]=this.value&&this.value[r]||a.required&&a.default||void 0;else{var n=t.querySelector('[name="'+r+'"]');if(n)switch(a.type){case"array":"textarea"===a.items.format?i[r]=""!==n.value?n.value.split("\n"):[]:"uri"===a.items.format?i[r]=n.data:(Array.isArray(n.value),i[r]=n.value);break;case"boolean":i[r]=n.checked;break;case"integer":i[r]=n.value?parseInt(n.value,10):"";break;case"number":i[r]=n.value?parseFloat(n.value):"";break;default:var s=a.format||"";"html"===s?i[r]=(n.innerHTML||"").trim():0===s.indexOf("custom:")&&"file"===n.type&&n.files&&n.files[0]?i[r]=1===n.files.length?n.data[0]:n.data:i[r]=(n.value||"").trim(),a.maxLength&&(i[r]=i[r].substr(0,Math.max(a.maxLength,0)))}a.required||""!==i[r]||delete i[r]}}}),i}function m(){var t=this.schema.properties,e={};return Object.keys(t).filter(function(e){return"links"!==e&&-1===e.indexOf("$")&&!t[e].readonly}).forEach(function(i){var r=t[i],a=this.querySelector('[name="'+i+'"]');if(a)switch(r.type){case"array":"uri"===r.items.format||"object"===r.items.type?e[i]=a.data:e[i]=a.value;break;case"boolean":e[i]=a.checked;break;default:e[i]=(a.value||"").trim()}}),e}function h(t){if(t){var e=this,r=c.call(this),a=t.href||i.location.href,n=(t.method||"POST").toLowerCase(),s=t.enctype||"application/json";e.clearErrors(),e.isValid(r)&&N[n](a,s,r,function(t){e.dispatchEvent(new CustomEvent("submit-complete",{detail:t,bubbles:!0,cancelable:!0}))},function(t){e.dispatchEvent(new CustomEvent("submit-complete",{detail:t,bubbles:!0,cancelable:!0})),t.body&&t.body.$schema&&(e.schema=t.body)})}}function f(t){var e=this,i=t,r={oldValue:this.value,newValue:i};e.dispatchEvent(new CustomEvent("value-set",{detail:r,bubbles:!0,cancelable:!0}))&&Object.keys(i).forEach(function(t){var r=e.querySelector('[name="'+t+'"]'),a=void 0!==i[t]?i[t]:"";r&&(E(r,a),e.schema.properties[t].maxLength&&l(r))})}function d(t,e){var i=null,r=e.items&&e.items.type||e.type,a=(e.items&&e.items.format||e.format||"").toLowerCase();switch(r){case"number":case"integer":if(Number.isInteger(e.minimum)&&Number.isInteger(e.maximum)){p(i=p(null,"select",{name:t,id:t}),"option",{value:""});for(var n=e.minimum;n<=e.maximum;n++)p(i,"option",{value:n},n)}else i=p(null,"input",{name:t,id:t,type:"number",value:""});break;default:if(Array.isArray(e.enum))p(i=p(null,"select",{name:t,id:t}),"option",{value:""}),e.enum.forEach(function(t){p(i,"option",{value:t},t)});else switch(a){case"url":case"uri":i=p(null,"input",{name:t,id:t,type:"url",value:""});break;case"textarea":i=p(null,"textarea",{name:t,id:t,value:"",rows:3});break;case"html":i=p(null,"div",{name:t,id:t,contenteditable:!0,rows:3});break;case"date":i=p(null,"input",{name:t,id:t,type:"date",value:""});break;case"password":i=p(null,"input",{name:t,id:t,type:"password",value:"",autocomplete:"new-password"});break;case"email":i=p(null,"input",{name:t,id:t,type:"email",pattern:T.email,value:""});break;default:if(w(a,T.customURC)){var s=T.customURC.exec(a);if(!s||3!==s.length)throw new Error("Invalid custom format on field "+t);var o=s[1],u=(s[2]||"").split(",").filter(Boolean);i=p(null,o,{name:t,id:t}),u.forEach(function(t){var e=t.split("="),r=e[0],a=e[1];i.setAttribute(r,a)})}else i=p(null,"input",{name:t,id:t,type:"text",value:""})}}return i&&(i.getAttribute("autocomplete")||i.setAttribute("autocomplete","off"),e.readonly&&i.setAttribute("readonly","true"),e.readonly&&"SELECT"===i.tagName&&i.setAttribute("disabled","true"),e.required&&i.setAttribute("required","required"),e.pattern&&i.setAttribute("pattern",e.pattern),e.min&&i.setAttribute("min",e.min),e.max&&i.setAttribute("max",e.max),e.minLength&&i.setAttribute("minlength",e.minLength),e.maxLength&&i.setAttribute(this.enforceMaxLength?"maxlength":"data-maxlength",e.maxLength),e.minItems&&i.setAttribute("min-items",e.minItems),e.maxItems&&i.setAttribute("max-items",e.maxItems),e.description&&e.description.length<this.placeholderMaxLength&&i.setAttribute("placeholder",e.description||"")),i}function b(t,e,i){i="className"===(e="class"===e?"className":e)?"(^|\\s)"+i+"(\\s|$)":i;for(var r=t.parentNode;null!==r&&r.tagName&&"html"!==r.tagName.toLowerCase();){if(r[e]===i||r.getAttribute(e)===i||"className"===e&&r[e].matches(i))return r;r=r.parentNode}return null}function p(t,e,r,a,n){var s=i.createElement(e),o=e.indexOf("-")>0;return t="string"==typeof t&&""!==t?i.querySelector(t):t,r=r||{},Object.keys(r).forEach(function(t){"class"===t?s.className=r[t]:"style"===t?s.setAttribute("style",r[t]):"id"===t?s.id=r[t]:"name"===t?s.setAttribute(t,r[t]):o||t in s?s[t]=r[t]:s.setAttribute(t,r[t])}),void 0!==a&&"object"!=typeof a&&s.appendChild(i.createTextNode(a)),void 0!==n&&(s.innerHTML="",v(n,s)),t&&t.appendChild(s),s}function v(t,e){e=e||i.createDocumentFragment();var r=null,a=i.createElement("div");a.innerHTML=t;for(var n=a.getElementsByTagName("script"),s=n.length-1;s>=0;s--)n[s].parentElement.removeChild(n[s]);for(;r=a.firstChild;)e.appendChild(r);return e}function g(t,e,i){var r=y(t,e,!0),a=(i+"").length;if(r){if(i&&"string"===r.type&&"email"===r.format&&!w(i.toString(),T.email))return"Invalid email address";if(i&&r.minLength&&a<r.minLength)return"The value must have a minimum of "+r.minLength+" character(s)";if(i&&r.maxLength&&a>r.maxLength)return"Maximum "+r.maxLength+" character"+(a>1?"s":"");if(r.required&&(!i||Array.isArray(i)&&i.length<=0))return"This field must have a value";if(r.minItems&&Array.isArray(i)&&i.length<r.minItems)return"Please select at least "+r.minItems+" item(s)";if(r.maxItems&&Array.isArray(i)&&i.length>r.maxItems)return"Please select a maximum of "+r.maxItems+" item(s)";if(i&&r.pattern&&!w(i.toString(),r.pattern))return"The value is not in the expected format";if(i&&r.minimum&&parseInt(i,10)<r.minimum)return"The value must not be lower than "+r.minimum;if(i&&r.maximum&&parseInt(i,10)>r.maximum)return"The value must not be higher than "+r.maximum}return null}function y(t,e,i){if(void 0===t)return!1;(i=void 0!==t.$schema||i)&&(t.properties&&e.indexOf(".properties")<=-1?e="properties."+e:t.items&&e.indexOf(".items")<=-1&&(e="items."+e));var r=e.indexOf(".");return r>-1?(t=t[e.substring(0,r)],e=e.substr(r+1),y(t,e,i)):t[e]}function A(t){t=t.properties||t;var e=Object.keys(t);return e.sort(function(e,i){return(t[e].id?parseInt(t[e].id.replace(/[^0-9]+/gi,"")||"0",10):0)-(t[i].id?parseInt(t[i].id.replace(/[^0-9]+/gi,"")||"0",10):0)}),e}function E(t,e){var i=t?t.tagName.toLowerCase():"",r=t.type||"";switch(i){case"input":"checkbox"===r?e?t.setAttribute("checked",!0===e):t.removeAttribute("checked"):t.value=e;break;case"textarea":t.value=e.join?e.join("\n"):e;break;case"div":t.innerHTML=e||"";break;default:t.value=e}}function x(t,e,i,r){for(var a=[],n=0,s=(t=t||[]).length;n<s;n++)if(t[n][e]===i){if(r)return t[n];a.push(t[n])}return r?null:a}function k(t,e){var r=(t||i).querySelector(e);r&&r.parentElement.removeChild(r)}function w(t,e){return(e.constructor!==RegExp?new RegExp(e,"g"):e).test(t)}function C(t,e){var i=new FileReader;i.onload=function(){e(i.result.split(",").pop())},i.readAsDataURL(t)}var L="ontouchstart"in e||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0?"touchend":"click",T={email:/^[a-zA-Z0-9-_.]{1,}@[a-zA-Z0-9.-]{2,}[.]{1}[a-zA-Z]{2,}$/,customURC:/^custom:([a-z0-9-]*)(?:;|)([a-z0-9-=/*,.]+|)$/i},S=Object.create(t,{action:{get:function(){return this.getAttribute("action")||""},set:function(t){this.setAttribute("action",t||"")}},enctype:{get:function(){return this.getAttribute("enctype")||"application/x-www-form-urlencoded"},set:function(t){this.setAttribute("enctype",t||"application/x-www-form-urlencoded")}},method:{get:function(){return this.getAttribute("method")||"get"},set:function(t){this.setAttribute("method",t||"get")}},src:{get:function(){return this.getAttribute("src")||""},set:function(t){this.setAttribute("src",t||"")}},schema:{get:function(){return this._schema||null},set:function(t){this._schema=t,this.title=this._schema.title,this.description=this._schema.description,t.id?this.setAttribute("schema-id",t.id):this.removeAttribute("schema-id"),n.call(this)}},value:{get:function(){return c.call(this)},set:function(t){f.call(this,t)}},readonly:{get:function(){return"true"===this.getAttribute("readonly")},set:function(t){t?this.setAttribute("readonly",t):this.removeAttribute("readonly")}},title:{get:function(){return this.getAttribute("title")||""},set:function(t){this.setAttribute("title",t||"")}},description:{get:function(){return this.getAttribute("description")||""},set:function(t){this.setAttribute("description",t||"")}},buttons:{get:function(){return this.getAttribute("buttons")||""},set:function(t){t=t.split(",").filter(Boolean).join(","),this.setAttribute("buttons",t)}},persist:{get:function(){return"true"===this.getAttribute("persist")},set:function(t){this.setAttribute("persist",!0===t)}},disableValidation:{get:function(){return"true"===this.getAttribute("disable-validation")},set:function(t){this.setAttribute("disable-validation",!0===t)}},placeholderMaxLength:{get:function(){return parseInt(this.getAttribute("placeholder-max-length")||"75",10)},set:function(t){this.setAttribute("placeholder-max-length",t)}},autofocusError:{get:function(){return"true"===this.getAttribute("autofocus-error")},set:function(t){this.setAttribute("autofocus-error",!0===t)}},validateOnBlur:{get:function(){return"true"===this.getAttribute("validate-on-blur")},set:function(t){this.setAttribute("validate-on-blur",!0===t),t&&(this.autofocusError=!1)}},tabOnEnter:{get:function(){return"true"===this.getAttribute("tab-on-enter")},set:function(t){this.setAttribute("tab-on-enter",!0===t)}},useFormTag:{get:function(){return"false"!==this.getAttribute("use-form-tag")},set:function(t){this.setAttribute("use-form-tag",!0===t)}},enforceMaxLength:{get:function(){return"true"===this.getAttribute("enforce-max-length")},set:function(t){this.setAttribute("enforce-max-length",!0===t)}},schemaId:{get:function(){return this.getAttribute("schema-id")||""}}});S.createdCallback=function(){var t=this;Array.prototype.slice.call(t.attributes).forEach(function(e){t.attributeChangedCallback(e.name,null,e.value)}),t.addEventListener("button-clicked",function(e){var i=e.detail.link;i&&(0===i.rel.toLowerCase().indexOf("describedby:")?this.src=i.href:t.dispatchEvent(new CustomEvent("submit",{bubbles:!0,cancelable:!0}))&&h.call(this,i))})},S.attributeChangedCallback=function(t,e,i){if(e!==i)switch(t){case"src":a.call(this);break;case"title":s.call(this);break;case"description":o.call(this);break;case"buttons":u.call(this);break;case"enctype":case"action":case"use-form-tag":case"enforce-maxlength":var r=this.value;n.call(this),this.value=r}},S.clearError=function(t){var e=this.querySelector('[name="'+t+'"]');e&&(e.setAttribute("data-valid","true"),e.parentNode.removeAttribute("data-error"))},S.clearErrors=function(){this.form.removeAttribute("data-error"),Array.prototype.slice.call(this.querySelectorAll("[data-error]")).forEach(function(t){t.removeAttribute("data-error")}),Array.prototype.slice.call(this.querySelectorAll("[data-valid]")).forEach(function(t){t.removeAttribute("data-valid")})},S.setError=function(t,e){var i=this.querySelector('[name="'+t+'"]');i&&(i.setAttribute("data-valid","false"),i.parentNode.setAttribute("data-error",e))},S.isValid=function(t,i){if(this.disableValidation)return!0;t=t||c.call(this);var r=this,a=this.schema,n=!0;if(Object.keys(t).forEach(function(e){var s=r.querySelector('[name="'+e+'"]'),o=a.properties[e],u="";u=(o?o.pattern:null)&&s?s.value:t[e];var l=g(a,e,u);i?l&&(n=!1):l?(r.setError(e,l),n=!1):r.clearError(e)}),this.persist&&e.sessionStorage&&(e.sessionStorage[this.src]=JSON.stringify(m.call(this))),!i&&this.autofocusError){var s=this.querySelector('form [data-valid="false"]');s&&s.focus()}return i||(n?this.dispatchEvent(new CustomEvent("validation-passed",{bubbles:!0,cancelable:!0})):this.dispatchEvent(new CustomEvent("validation-failed",{bubbles:!0,cancelable:!0}))),n},S.reset=function(){var t={},e=(this.schema||{}).properties||{};Object.keys(e).filter(function(t){return"links"!==t&&t.indexOf("$")<=-1}).forEach(function(i){t[i]=e[i].default||""}),this.value=t},S.submit=function(t){if(this.disableValidation||this.isValid()){if(t){var e=this.schema&&Array.isArray(this.schema.links)?x(this.schema.links,"rel",t,!0):null;e&&this.dispatchEvent(new CustomEvent("submit",{bubbles:!0,cancelable:!0}))&&h.call(this,e)}else this.form&&"FORM"===this.form.tagName&&"function"==typeof this.form.submit&&this.dispatchEvent(new CustomEvent("submit",{bubbles:!0,cancelable:!0}))&&this.form.submit()}},"initCustomEvent"in i.createEvent("CustomEvent")&&(e.CustomEvent=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var r=i.createEvent("CustomEvent");return r.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),r},e.CustomEvent.prototype=e.Event.prototype);var N=function(){function t(t){return Object.keys(t||{}).map(function(e){return encodeURI(e+"="+t[e])}).join("&")}function i(t,e){return(t||"").indexOf("application/json")>-1?JSON.parse(e||"{}"):e||""}function r(r,a,n,s,o,u){var l="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;if(l){if(r=r||"GET",n=n||"application/json",l.open(r,a),l.withCredentials=!0,l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("Content-Type",n),e.sessionStorage&&sessionStorage.authToken&&""!==sessionStorage.authToken&&l.setRequestHeader("Authorization","Bearer "+sessionStorage.authToken),l.onreadystatechange=function(){if(4===l.readyState){var t=i(l.getResponseHeader("content-type"),l.responseText);200===l.status||0===l.status&&""!==l.responseText?u({url:a,status:200,body:t}):o({url:a,status:l.status,body:t})}},s)switch(n){case"application/x-www-form-urlencoded":s=t(s);break;default:s=JSON.stringify(s)}l.send(s||null)}}return{get:function(t,e,i,a,n){r("GET",t,e,i,a,n)},post:function(t,e,i,a,n){r("POST",t,e,i,a,n)},put:function(t,e,i,a,n){r("PUT",t,e,i,a,n)},patch:function(t,e,i,a,n){r("PATCH",t,e,i,a,n)},delete:function(t,e,i,a,n){r("DELETE",t,e,i,a,n)}}}();if(!i.registerElement)throw new Error("document.registerElement does not exist. Are you missing the polyfill?");i.registerElement("pure-form",{prototype:S})}(HTMLElement.prototype,this,document);